<form
    data-request="jobPostEdit::onSave"
    data-request-success="$('#job_posted').modal('show');"
    data-browser-validate
    action=""
    method="POST"
    enctype="multipart/form-data"
    id="form-job">
    <!-- Step 1 -->
    <div class="deposit-form container-steps" id="step1">
        <div class="mb-5">
            <div class="status">
                <span>First Step!</span>
                <span>1/4</span>
            </div>
            <div class="progress">
            <div class="progress-bar bg-success" role="progressbar" style="width: 0%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
            </div>
        </div>
        <div class="title-list mb-4">Create New Job</div>
        <div class="group-li mb-3">
            <label for="position">Position / Job Title</label>
            <input type="text" name="title" value="{{ job.title }}" required class="form-control form-th" placeholder="Job Title">
        </div>
        <div class="group-li mb-3">
            <label for="ref_job_type_id">Job Type</label>
            <select
                name="ref_job_type_id"
                id="ref_job_type_id"
                class="form-select form-th custom-select2"
                required>
                <option value>Select Job Type</option>
                {% for item in master.jobTypes() %}
                <option value="{{ item.id }}" {% if item.id == job.ref_job_type_id %} selected {% endif %}>{{ item.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="group-li form-check ps-0">
                    <label for="">Minimum Working Experience & People Required</label>
                </div>
            </div>
            <div class="col-md-6">
                <div class="group-li mb-3">
                    <input class="form-check-input check-req-input" data-error="#error-level_experiences" data-req="#freshgrad_number" name="level_experiences[]" required type="checkbox" value="freshgrad_number" id="fresh_graduate" {% if job.freshgrad_number > 0 %} checked {% endif %}>
                    <label class="form-check-label text-blue font-weight-500" for="fresh_graduate">
                        Fresh Graduate (0 Year Experience)
                    </label>
                    <input type="number" min="1" max="999" name="freshgrad_number" id="freshgrad_number" disabled value="{{ user.freshgrad_number }}" class="form-control form-th mt-2" placeholder="People Required for This Working Experience">
                </div>
            </div>
            <div class="col-md-6">
                <div class="group-li mb-3">
                    <input class="form-check-input check-req-input" data-req="#junior_number" name="level_experiences[]" type="checkbox" value="junior_number" id="junior" {% if job.junior_number > 0 %} checked {% endif %}>
                    <label class="form-check-label text-blue font-weight-500" for="junior">
                        Junior (1-3 Years Experience)
                    </label>
                    <input type="number" min="1" max="999" name="junior_number" id="junior_number" disabled value="{{ user.junior_number }}" class="form-control form-th mt-2" placeholder="People Required for This Working Experience">
                </div>
            </div>
            <div class="col-md-6">
                <div class="group-li mb-3">
                    <input class="form-check-input check-req-input" data-req="#middle_number" name="level_experiences[]" type="checkbox" value="middle_number" id="middle" {% if job.middle_number > 0 %} checked {% endif %}>
                    <label class="form-check-label text-blue font-weight-500" for="middle">
                        Middle (3-5 Years Experience)
                    </label>
                    <input type="number" min="1" max="999" name="middle_number" id="middle_number" disabled value="{{ user.middle_number }}" class="form-control form-th mt-2" placeholder="People Required for This Working Experience">
                    <label id="error-level_experiences"></label>
                </div>
            </div>
            <div class="col-md-6">
                <div class="group-li mb-3">
                    <input class="form-check-input check-req-input" data-req="#senior_number" name="level_experiences[]" type="checkbox" value="senior_number" id="senior" {% if job.senior_number > 0 %} checked {% endif %}>
                    <label class="form-check-label text-blue font-weight-500" for="senior">
                        Senior (More than 5 Years Experience)
                    </label>
                    <input type="number" min="1" max="999" name="senior_number" id="senior_number" disabled value="{{ user.senior_number }}" class="form-control form-th mt-2" placeholder="People Required for This Working Experience">
                </div>
            </div>
        </div>
        <div class="row mt-5">
            <div class="col">
                <a class="btn btn-outline-secondary w-100 py-2" href="#">Cancel</a>
            </div>
            <div class="col">
                <a href="#" class="btn btn-primary w-100 py-2 btn-next" data-next="#step2">Next</a>
            </div>
        </div>
    </div>

    <!-- Step 2 -->
    <div class="deposit-form container-steps hide" id="step2">
        <div class="mb-5">
            <div class="status">
                <span>Getting Closer!</span>
                <span>2/4</span>
            </div>
            <div class="progress">
            <div class="progress-bar bg-success" role="progressbar" style="width: 25%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
            </div>
        </div>
        <div class="title-list mb-2">Job Detail</div>
        <div class="group-li mb-3">
            <label for="description">Job Description</label>
            <textarea name="description" id="editor" required placeholder="Your Job Description" rows="5">{{ job.description }}</textarea>
        </div>
        <div class="row">
            <div class="col-md-6">
                <div class="group-li mb-3">
                    <label for="">Job Location (Province)</label>
                    <select name="province_code" id=""
                        class="form-select form-th custom-select2"
                        data-handler="master::onSearchLocation"
                        data-minimum-input-length="2"
                        data-ajax--delay="300"
                        required
                    >
                        <option value="">Choose Province</option>
                        {% if job.province_code %}
                            <option selected value="{{ job.province_code }}">{{ job.province.name }}</option>
                        {% endif %}
                    </select>
                </div>
            </div>
            <div class="col-md-6">
                <div class="group-li mb-3">
                    <label for="">Job Location (City)</label>
                    <select name="city_code" id="city_code"
                        class="form-select form-th custom-select2"
                        {% if not job.city_code %} disabled {% endif %}
                        required
                    >
                        {% partial 'select-options' defaultText='Choose City' selected={value: job.city_code, label: job.city.name} %}
                    </select>
                </div>
            </div>
        </div>
        <div class="group-li mb-3">
            <label for="">Skill Required</label>
            <select name="skills[]" id=""
                class="form-select form-th custom-select2"
                data-handler="master::onSearchSkill"
                data-minimum-input-length="2"
                data-ajax--delay="300"
                multiple="multiple"
                required
            >
            </select>
        </div>
        <div class="row">
            <div class="col-md-5">
                <div class="group-li mb-3">
                    <label for="description">Monthly Salary Range</label>
                    <input type="text" data-rule-number="true" data-rule-minlength="7" data-rule-maxlength="12" name="min_salary" value="{{ user.min_salary }}" class="form-control form-th mt-2" placeholder="Min Salary">
                </div>
            </div>
            <div class="col-md-2 d-flex justify-content-center align-items-center">
                <div class="group-li">
                    <label for="description">to</label>
                </div>
            </div>
            <div class="col-md-5">
                <div class="group-li mb-3">
                    <label for="description"></label>
                    <input type="text" data-rule-number="true" data-rule-minlength="7" data-rule-maxlength="12" name="max_salary" value="{{ user.max_salary }}" class="form-control form-th mt-2" placeholder="Max Salary">
                </div>
            </div>
        </div>
        <div class="group-li mb-3">
            <input class="form-check-input" type="checkbox" value="true" id="is_display_salary" {% if job.is_display_salary %} checked {% endif %}>
            <label class="form-check-label text-blue font-weight-500" for="is_display_salary">
                Display salary in the job post
            </label>
        </div>
        <div class="group-li mb-3">
            <label for="process">Process</label>
            <input type="number" name="cv_days_processed" value="{{ job.cv_days_processed }}" required class="form-control form-th" placeholder="How long do you process CV?">
        </div>
        <div class="group-li form-check mb-3">
            <input class="form-check-input" type="checkbox" value="true" id="is_placement" name="is_placement" {% if job.placement_id %} checked {% endif %}>
            <label class="form-check-label" for="is_placement">
                Is it for your Client?
            </label>
        </div>
        <div class="group-li mb-3 hide" id="container_placement_id">
            <label for="placement_id">Client</label>
            <select
                name="placement_id"
                id="placement_id"
                class="form-select form-th custom-select2">
                <option value>Select your Client</option>
                {% for item in client_divisions %}
                <option value="{{ item.id }}" {% if item.id == job.placement_id %} selected {% endif %}>{{ item.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="row mt-5">
            <div class="col">
                <a class="btn btn-outline-secondary w-100 py-2 btn-prev" data-prev="#step1" href="#">Back</a>
            </div>
            <div class="col">
                <a
                    href="#"
                    class="btn btn-primary w-100 py-2 btn-next"
                    data-callback="calculateFee()"
                    data-next="#step3"
                >Next</a>
            </div>
        </div>
    </div>

    <!-- Step 3 -->
    <div class="deposit-form container-steps hide" id="step3">
        <div class="mb-5">
            <div class="status">
                <span>Almost There!</span>
                <span>3/4</span>
            </div>
            <div class="progress">
            <div class="progress-bar bg-success" role="progressbar" style="width: 25%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
            </div>
        </div>
        <div class="title-list mb-2">Deposit</div>
        <!-- <p class="mb-4">You can use <b class="text-bluedark">"Priority Fee"</b> to boost your job post to the top of the list</p> -->
        <div class="group-li">
            <label for="position">Standard Fee
                <div class="l-tooltip l-tooltip-feather">
                    <i data-feather="help-circle"></i>
                    <span class="l-tooltiptext">
                        Standard fee is a predetermined deposit system for posting new jobs which is charged per person according to company needs. If within the specified period but the company does not succeed in getting talent, then the deposit fee will be returned 80%.
                    </span>
                </div>
            </label>
        </div>
        <div id="preview-job-fee">
            {% partial 'mycompany/job/preview-job-fee' %}
        </div>
        <!-- <div class="group-li mb-3">
            <label for="position">Priority Fee (Optional)
                <div class="l-tooltip l-tooltip-feather">
                    <i data-feather="help-circle"></i>
                    <span class="l-tooltiptext">
                        Priority fee is additional costs that can be adjusted according to the company's ability based on the highest priority fee amount to boost your job post to the top of the list and easily get more talent.
                    </span>
                </div>
            </label>
            <div class="inner-dl multiple-select">
                <input type="number" name="priority_fee" value="{{ job.priority_fee }}" class="form-control form-th" placeholder="Priority Fee (Optional)">
                <a href="javascript:void(0);" class="btn btn-dl btn-plus"><i data-feather="plus-circle"></i></a>
            </div>
        </div> -->
        <div class="row">
            <div class="col">
                <div class="group-li mb-3">
                    <label for="">Payment Method</label>
                    <div class="multiple-select-content">
                        <div class="inner-dl multiple-select qualification-container">
                        <select class="form-select form-th custom-select2 select-creatable"
                            data-placeholder="Payment Method"
                            required
                            name="payments[ref_payment_method_id][]"
                        >
                            <option value>Choose Your Payment Method</option>
                            {% for item in master.paymentMethods() %}
                            <option value="{{ item.id }}" {% if item.id == 1 %} selected {% endif %}>{{ item.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="group-li mb-3">
                    <label for="">Destination Bank</label>
                    <div class="multiple-select-content">
                        <div class="inner-dl multiple-select qualification-container">
                        <select class="form-select form-th custom-select2 select-creatable"
                            data-placeholder="Payment Method"
                            required
                            name="payments[ref_bank_account_id][]"
                        >
                            <option value>Choose Desination Bank</option>
                            {% for item in master.bankAccounts() %}
                            <option value="{{ item.id }}">
                                {{ item.ref_bank.name }} - {{ item.acc_name }} - {{ item.acc_number }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row mt-5">
            <div class="col">
                <a class="btn btn-outline-secondary w-100 py-2 btn-prev" data-prev="#step2" href="#">Back</a>
            </div>
            <div class="col">
                <a href="#" class="btn btn-primary w-100 py-2 btn-next" data-next="#step4"
                data-callback="previewInvoice()">Next</a>
            </div>
        </div>
    </div>

    <!-- Step 4 -->
    <div class="deposit-form container-steps hide" id="step4">
        <div class="mb-5">
            <div class="status">
                <span>Invoice</span>
                <span>4/4</span>
            </div>
            <div class="progress">
            <div class="progress-bar bg-success" role="progressbar" style="width: 66.666%" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
            </div>
        </div>
        <div class="title-list mb-4">Payment Detail</div>
        <div id="preview-invoice">
            {% partial 'mycompany/job/preview-invoice' %}
        </div>
        <div class="row mt-5">
            <div class="col">
                <a class="btn btn-outline-secondary w-100 py-2 btn-prev" data-prev="#step3" href="#">Back</a>
            </div>
            <div class="col">
                <button data-attach-loading class="btn btn-yellow w-100 py-2">Finish</a>
            </div>
        </div>
    </div>
</form>

{% put scripts %}
<script src="{{ 'assets/vendor/ckeditor5/build/ckeditor.js'|theme }}"></script>
<script>
    ClassicEditor
        .create( document.querySelector( '#editor' ), {
            toolbar: ["heading", "|", "bold", "italic", "underline", "link", "bulletedList", "numberedList", "|", "outdent", "indent", "|", "undo", "redo"],
        } )
        .catch( error => {
            console.error( error );
        } );
</script>
{% endput %}

{% put scripts %}
<script type="text/javascript">
    $(document).ready(function(){
        $('#is_placement').change();
    });

    $(document).on('change', '#is_placement', function() {
        $('#container_placement_id').addClass('hide');
        if ($(this).is(':checked')) {
            $('#container_placement_id').removeClass('hide');
        }
    });

    $( function() {
        var changeProvince = (ele, isKeepVal) => {
            var code = $(ele).val();
            var city = $('[name=city_code]');
            if (!isKeepVal) $('[name=city_code]').val('').trigger('change').attr('disabled', 'disabled');
            if (code) city.removeAttr('disabled');
            city.attr('data-request-data', "type: 'city', code: '" + code  + "'");
            $.request('master::onSearchLocation',{
                data: { type: 'city', code: code, defaultText: 'Choose City', selected: {value: '{{ job.city_code }}'} },
                update: { 'select-options': '#city_code' },
                afterUpdate : function(data){
                    console.log(data);
                    refreshEle();
                },
            });
        };

        changeProvince('[name=province_code]', 1, 1);

        $('[name=province_code]').on('change', function() {
            changeProvince(this);
        });
    });

    function calculateFee () {
        $.request('jobPostEdit::onCalculateFee',{
            data: {
                freshgrad_number: $('#freshgrad_number').val(),
                junior_number: $('#junior_number').val(),
                middle_number: $('#middle_number').val(),
                senior_number: $('#senior_number').val(),
            },
            update: { 'mycompany/job/preview-job-fee': '#preview-job-fee' },
            afterUpdate : function(data){
                refreshEle();
            },
        });
    };

    function previewInvoice () {
        $.request('jobPostEdit::onPreviewInvoice',{
            form: '#form-job',
            update: { 'mycompany/job/preview-invoice': '#preview-invoice' },
            afterUpdate : function(data){
                refreshEle();
            },
        });
    };
</script>
{% endput %}
